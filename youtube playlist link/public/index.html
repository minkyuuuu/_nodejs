<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube ì¬ìƒëª©ë¡ ë§í¬ ì¶”ì¶œê¸°</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: rgba(255, 255, 255, 0.95); border-radius: 20px; padding: 30px; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1); backdrop-filter: blur(10px); }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: #333; font-size: 2.5rem; margin-bottom: 10px; background: linear-gradient(45deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .header p { color: #666; font-size: 1.1rem; }
        .input-section { background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 30px; border: 2px solid #e9ecef; }
        .input-group { display: flex; gap: 15px; margin-bottom: 20px; }
        .input-field { flex: 1; padding: 15px; border: 2px solid #dee2e6; border-radius: 10px; font-size: 1rem; transition: all 0.3s ease; }
        .input-field:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        .btn { padding: 10px 20px; border: none; border-radius: 10px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 1px; }
        .btn:disabled { background: #adb5bd; cursor: not-allowed; transform: none; box-shadow: none; }
        .btn-primary { background: linear-gradient(45deg, #667eea, #764ba2); color: white; padding: 15px 30px; }
        .btn-primary:not(:disabled):hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3); }
        .btn-secondary, .btn-excel { color: white; }
        .btn-secondary { background: #6c757d; }
        .btn-secondary:hover { background: #5a6268; }
        .btn-excel { background: #207245; }
        .btn-excel:hover { background: #1a5935; }
        .info-section { display: none; background: #e8f5e8; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 5px solid #28a745; }
        .info-section h3 { color: #155724; margin-bottom: 10px; }
        .info-section p { color: #155724; margin: 5px 0; }
        .loading { display: none; text-align: center; padding: 40px; }
        .spinner { width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .results-section { display: none; }
        .video-list { background: #fff; border-radius: 15px; padding: 20px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); }
        .video-item { display: flex; align-items: center; padding: 15px; border-bottom: 1px solid #eee; transition: background-color 0.3s ease; }
        .video-item:hover { background-color: #f8f9fa; }
        .video-item:last-child { border-bottom: none; }
        .video-thumbnail { width: 120px; height: 68px; background: #f0f0f0; border-radius: 8px; margin-right: 15px; overflow: hidden; flex-shrink: 0; }
        .video-thumbnail img { width: 100%; height: 100%; object-fit: cover; }
        .video-info { flex: 1; }
        .video-title { font-weight: 600; color: #333; margin-bottom: 5px; line-height: 1.4; }
        .video-meta { font-size: 0.9rem; color: #666; margin-bottom: 8px; }
        .video-url { color: #667eea; font-size: 0.9rem; text-decoration: none; word-break: break-all; }
        .video-url:hover { text-decoration: underline; }
        .stats { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px; flex-wrap: wrap; gap: 10px; }
        .error { background: #f8d7da; color: #721c24; padding: 15px; border-radius: 10px; margin: 20px 0; border: 1px solid #f5c6cb; }
        .export-buttons { display: flex; gap: 10px; flex-wrap: wrap; }
        .copy-link-btn { padding: 5px 10px; font-size: 0.8rem; background: #e9ecef; color: #495057; border-radius: 5px; cursor: pointer; border: 1px solid #dee2e6; margin-left: 10px; }
        .copy-link-btn:hover { background: #ced4da; }
        @media (max-width: 768px) { .container { padding: 20px; } .input-group { flex-direction: column; } .header h1 { font-size: 2rem; } .video-item { flex-direction: column; align-items: flex-start; } .video-thumbnail { margin-bottom: 10px; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¬ YouTube ì¬ìƒëª©ë¡ ë§í¬ ì¶”ì¶œê¸°</h1>
            <p>YouTube ì¬ìƒëª©ë¡ URLì„ ì…ë ¥í•˜ì—¬ ëª¨ë“  ë™ì˜ìƒ ë§í¬ë¥¼ ì¶”ì¶œí•˜ê³  ì €ì¥í•˜ì„¸ìš”</p>
        </div>

        <div class="input-section">
            <div class="input-group">
                <input type="text" class="input-field" id="playlistUrl" placeholder="ì¬ìƒëª©ë¡ ë§í¬ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”">
                <button class="btn btn-primary" id="extractBtn" onclick="extractPlaylist()" disabled>ğŸ“‹ ë§í¬ ì¶”ì¶œ</button>
            </div>
        </div>

        <div class="info-section" id="infoSection">
            <h3>ğŸ“Š ì¬ìƒëª©ë¡ ì •ë³´</h3>
            <p id="playlistTitle">ì œëª©: </p>
            <p id="playlistCount">ë™ì˜ìƒ ìˆ˜: </p>
        </div>

        <div class="loading" id="loadingSection">
            <div class="spinner"></div>
            <p>ì¬ìƒëª©ë¡ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
        </div>

        <div class="results-section" id="resultsSection">
             <div class="stats">
                 <div><strong>ì¶”ì¶œëœ ë™ì˜ìƒ: <span id="videoCount">0</span>ê°œ</strong></div>
                 <div class="export-buttons">
                     <button class="btn btn-secondary" onclick="exportAsText()">ğŸ“„ í…ìŠ¤íŠ¸ë¡œ ì €ì¥</button>
                     <button class="btn btn-secondary" onclick="exportAsJSON()">ğŸ’¾ JSONìœ¼ë¡œ ì €ì¥</button>
                     <button class="btn btn-excel" onclick="exportAsExcel()">ğŸ“Š ì—‘ì…€ë¡œ ë‹¤ìš´ë¡œë“œ</button>
                     <button class="btn btn-secondary" onclick="copyToClipboard()">ğŸ“‹ í´ë¦½ë³´ë“œì— ë³µì‚¬</button>
                 </div>
             </div>
            <div class="video-list" id="videoList"></div>
        </div>
        <div id="errorContainer"></div>
    </div>

    <script>
        let extractedVideos = [];
        const API_SERVER_URL = 'http://localhost:3000';

        function extractPlaylistId(url) {
            const regex = /[?&]list=([^&]+)/;
            const match = url.match(regex);
            return match ? match[1] : null;
        }

        async function extractPlaylist() {
            const url = document.getElementById('playlistUrl').value.trim();
            if (!url) { return alert('ì¬ìƒëª©ë¡ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); }
            const playlistId = extractPlaylistId(url);
            if (!playlistId) { return alert('ì˜¬ë°”ë¥¸ YouTube ì¬ìƒëª©ë¡ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); }

            document.getElementById('loadingSection').style.display = 'block';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('infoSection').style.display = 'none';
            document.getElementById('errorContainer').innerHTML = '';

            try {
                const response = await fetch(`${API_SERVER_URL}/api/playlist/${playlistId}`);
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `ì„œë²„ ì˜¤ë¥˜: ${response.status}`);
                }
                const data = await response.json();
                displayResults(data.videos, data.playlistTitle, data.totalCount);
            } catch (error) {
                console.error('Error:', error);
                showError('ì¬ìƒëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            } finally {
                document.getElementById('loadingSection').style.display = 'none';
            }
        }

        function displayResults(videos, playlistTitle, totalCount) {
            extractedVideos = videos;
            document.getElementById('playlistTitle').textContent = `ì œëª©: ${playlistTitle}`;
            document.getElementById('playlistCount').textContent = `ë™ì˜ìƒ ìˆ˜: ${totalCount}ê°œ`;
            document.getElementById('infoSection').style.display = 'block';
            document.getElementById('videoCount').textContent = videos.length;
            document.getElementById('resultsSection').style.display = 'block';
            
            const videoList = document.getElementById('videoList');
            videoList.innerHTML = '';
            
            videos.forEach((video, index) => {
                const videoUrl = `https://www.youtube.com/watch?v=${video.id}`;
                const videoItem = document.createElement('div');
                videoItem.className = 'video-item';
                videoItem.innerHTML = `
                    <div class="video-thumbnail">
                        <a href="${videoUrl}" target="_blank"><img src="${video.thumbnail}" alt="ì¸ë„¤ì¼" onerror="this.style.display='none'"></a>
                    </div>
                    <div class="video-info">
                        <div class="video-title">${index + 1}. ${video.title}</div>
                        <div class="video-meta">
                            <span>ì¬ìƒì‹œê°„: ${formatDuration(video.duration)}</span> | <span>ì—…ë¡œë“œ: ${formatDate(video.publishedAt)}</span>
                        </div>
                        <a href="${videoUrl}" target="_blank" class="video-url">${videoUrl}</a>
                        <button class="copy-link-btn" onclick="copySingleLink('${videoUrl}', this)">ğŸ”— ë§í¬ ë³µì‚¬</button>
                    </div>
                `;
                videoList.appendChild(videoItem);
            });
        }

        function copySingleLink(link, buttonElement) {
            navigator.clipboard.writeText(link).then(() => {
                const originalText = buttonElement.innerHTML;
                buttonElement.innerHTML = 'âœ… ë³µì‚¬ ì™„ë£Œ!';
                buttonElement.disabled = true;
                setTimeout(() => {
                    buttonElement.innerHTML = originalText;
                    buttonElement.disabled = false;
                }, 2000);
            });
        }
        
        function showError(message) {
            const errorContainer = document.getElementById('errorContainer');
            errorContainer.innerHTML = `<div class="error">${message}</div>`;
        }
        
        function formatDuration(isoDuration) {
            if (!isoDuration) return 'N/A';
            const match = isoDuration.match(/PT(\d+H)?(\d+M)?(\d+S)?/);
            if (!match) return 'N/A';
            const hours = parseInt(match[1]) || 0;
            const minutes = parseInt(match[2]) || 0;
            const seconds = parseInt(match[3]) || 0;
            if (hours > 0) return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function formatDate(isoDate) {
            if (!isoDate) return 'N/A';
            return isoDate.split('T')[0];
        }

        function downloadFile(content, filename, contentType) {
            const blob = new Blob([content], { type: `${contentType};charset=utf-8` });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function exportAsExcel() {
            if (extractedVideos.length === 0) return alert('ì¶”ì¶œëœ ë™ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.');

            const dataForSheet = extractedVideos.map((video, index) => ({
                'No': index + 1,
                'ì œëª©': video.title,
                'ì¬ìƒì‹œê°„': formatDuration(video.duration),
                'ì—…ë¡œë“œ ë‚ ì§œ': formatDate(video.publishedAt),
                'ë§í¬': `https://www.youtube.com/watch?v=${video.id}`
            }));

            const worksheet = XLSX.utils.json_to_sheet(dataForSheet, {
                header: ['No', 'ì œëª©', 'ì¬ìƒì‹œê°„', 'ì—…ë¡œë“œ ë‚ ì§œ', 'ë§í¬']
            });

            const range = XLSX.utils.decode_range(worksheet['!ref']);
            for (let R = range.s.r + 1; R <= range.e.r; ++R) {
                const cell_address = { c: 4, r: R }; 
                const cell_ref = XLSX.utils.encode_cell(cell_address);
                const cell = worksheet[cell_ref];
                if (cell && cell.v) {
                    cell.l = { Target: cell.v, Tooltip: "í´ë¦­í•˜ì—¬ ì˜ìƒ ì¬ìƒ" };
                }
            }

            worksheet['!cols'] = [ {wch:5}, {wch:80}, {wch:12}, {wch:12}, {wch:45} ];
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'ì¬ìƒëª©ë¡');
            
            const playlistTitle = document.getElementById('playlistTitle').textContent.replace('ì œëª©: ', '').trim();
            const safeFileName = playlistTitle.replace(/[^a-zA-Z0-9ê°€-í£]/g, '_');
            const fileName = `Youtubelist_${safeFileName}.xlsx`;
            XLSX.writeFile(workbook, fileName);
        }

        function exportAsText() {
            if (extractedVideos.length === 0) return alert('ì¶”ì¶œëœ ë™ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.');
            let content = `YouTube ì¬ìƒëª©ë¡ ë™ì˜ìƒ ë§í¬ ëª©ë¡\n\n`;
            // ##### ë„˜ë²„ë§ì´ ìˆ˜ì •ëœ ë¶€ë¶„ #####
            extractedVideos.forEach((video, index) => {
                content += `${index + 1}. ${video.title}\n`;
                content += `  â€¢ ì¬ìƒì‹œê°„: ${formatDuration(video.duration)}\n`;
                content += `  â€¢ ì—…ë¡œë“œ: ${formatDate(video.publishedAt)}\n`;
                content += `  â€¢ ë§í¬: https://www.youtube.com/watch?v=${video.id}\n\n`;
            });
            downloadFile(content, 'youtube_playlist.txt', 'text/plain');
        }

        function exportAsJSON() {
            if (extractedVideos.length === 0) return alert('ì¶”ì¶œëœ ë™ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.');
            const data = {
                playlistTitle: document.getElementById('playlistTitle').textContent.replace('ì œëª©: ', '').trim(),
                extractedAt: new Date().toISOString(),
                totalCount: extractedVideos.length,
                videos: extractedVideos.map(video => ({
                    id: video.id,
                    title: video.title,
                    duration: formatDuration(video.duration),
                    publishedAt: formatDate(video.publishedAt),
                    url: `https://www.youtube.com/watch?v=${video.id}`,
                    thumbnail: video.thumbnail
                }))
            };
            downloadFile(JSON.stringify(data, null, 2), 'youtube_playlist.json', 'application/json');
        }

        function copyToClipboard() {
            if (extractedVideos.length === 0) return alert('í´ë¦½ë³´ë“œì— ë³µì‚¬í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
            let content = '';
            // ##### ë„˜ë²„ë§ì´ ìˆ˜ì •ëœ ë¶€ë¶„ #####
            extractedVideos.forEach((video, index) => {
                content += `${index + 1}. ${video.title}\n`;
                content += `  â€¢ ì¬ìƒì‹œê°„: ${formatDuration(video.duration)}\n`;
                content += `  â€¢ ì—…ë¡œë“œ: ${formatDate(video.publishedAt)}\n`;
                content += `  â€¢ ë§í¬: https://www.youtube.com/watch?v=${video.id}\n\n`;
            });
            navigator.clipboard.writeText(content).then(() => {
                alert('ëª¨ë“  ì •ë³´ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });
        }
        
        window.addEventListener('load', () => {
            const playlistUrlInput = document.getElementById('playlistUrl');
            const extractBtn = document.getElementById('extractBtn');
            const updateButtonState = () => {
                setTimeout(() => { extractBtn.disabled = playlistUrlInput.value.trim() === ''; }, 0);
            };
            playlistUrlInput.addEventListener('input', updateButtonState);
            playlistUrlInput.addEventListener('paste', updateButtonState);
        });
    </script>
</body>
</html>